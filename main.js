(()=>{"use strict";var e=document.querySelector(".popup_avatar"),t=document.querySelector(".profile__avatar_button"),n=e.querySelector(".popup__close"),o=e.querySelector(".popup__item_avatar"),c=e.querySelector(".popup__input"),r=document.querySelector(".profile__avatar"),u=document.querySelector(".popup_pofil"),i=document.querySelector(".profile__button-edit"),a=u.querySelector(".popup__close"),l=(document.querySelector(".popup"),document.querySelector(".profile__button-add")),s=document.querySelector(".popup-card-nov"),d=s.querySelector(".popup__close"),p=(document.querySelector(".popup__input"),document.querySelector(".profile__name")),_=document.querySelector(".profile__occupation"),m=document.querySelector(".popup__item_name"),f=document.querySelector(".popup__item_occupation"),v=(document.querySelector(".popup__button-save"),document.querySelector(".elements__list")),y=document.querySelector(".elements__img_card"),h=document.querySelector(".popup__card_img"),S=h.querySelector(".popup__close"),q=document.querySelector(".elements__title_card"),b=document.querySelector(".popup__input_card"),k=document.querySelector(".popup__item-card-name"),E=document.querySelector(".popup__item-card-occupation"),L=document.querySelector(".item_template").content.querySelector(".elements__item").cloneNode(!0);function g(e,t){e.textContent=t?"Сохранение...":"Сохранить"}function C(e){"Escape"===e.key&&T(document.querySelector(".popup_opened"))}function x(e){e.target.classList.contains("popup")&&T(e.target)}function A(e){e.classList.add("popup_opened"),document.addEventListener("keydown",C),document.addEventListener("click",x)}function T(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",C),document.removeEventListener("click",x)}L.querySelector(".elements__img"),L.querySelector(".elements__title"),L.querySelector(".elements__group"),L.querySelector(".elements__dele");var U,B={formSelector:".popup__input",formSelectorCard:".popup__input_card",inputSelector:".popup__item",inputErrorClass:".popup__item_error",submitButtonSelector:".popup__button-save",inActiveButtonClass:"popup__button-save_disabled",errorClass:".popup__button-save_active"},w={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-1",headers:{authorization:"44181768-52c2-4bd5-af2c-8b3c8fbae037","Content-Type":"application/json"}},D=function(e){return e.ok?e.json():Promise.reject("ошибка ".concat(e.status))},N=s.querySelector(".popup__button-save-card");function P(e,t,n){var o=function(e,t){var n=document.querySelector(".item_template").content.querySelector(".elements__item").cloneNode(!0),o=n.querySelector(".elements__img"),c=n.querySelector(".elements__title"),r=n.querySelector(".elements__group"),u=n.querySelector(".elements__dele"),i=n.querySelector(".elements__group_nem");return o.setAttribute("src",e.link),o.setAttribute("alt",e.name),c.textContent=e.name,i.textContent=e.likes.length,e.likes.some((function(e){return e._id===t._id}))&&r.classList.add("elements__group_active"),o.addEventListener("click",(function(){y.src=o.src,y.alt=c.textContent,q.textContent=c.textContent,A(h)})),e.owner._id!==t._id?u.remove():u.addEventListener("click",(function(){var t;(t=e._id,fetch("".concat(w.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:w.headers})).then((function(e){u.closest(".elements__item").remove()})).catch((function(e){console.log(e)}))})),r.addEventListener("click",(function(n){var o,c=n.target;e.likes.some((function(e){return e._id===t._id}))?function(e){return fetch("".concat(w.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:w.headers}).then((function(e){return D(e)}))}(e._id).then((function(t){e.likes=t.likes,c.classList.remove("elements__group_active"),i.textContent=t.likes.length})).catch((function(e){console.log("Ошибка: ".concat(e))})):(o=e._id,fetch("".concat(w.baseUrl,"/cards/likes/").concat(o),{method:"PUT",headers:w.headers}).then((function(e){return D(e)}))).then((function(t){e.likes=t.likes,c.classList.add("elements__group_active"),i.textContent=t.likes.length})).catch((function(e){console.log("Ошибка: ".concat(e))}))})),n}(e,t);n.prepend(o)}b.addEventListener("submit",(function(e){var t,n;e.preventDefault(),g(N,!0),(t=k.value,n=E.value,fetch("".concat(w.baseUrl,"/cards"),{method:"POST",headers:w.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return D(e)}))).then((function(e){var t,n,o;P(e,U,v),b.reset(),t=B.submitButtonSelector,n=B.inActiveButtonClass,(o=b.querySelector(t)).classList.add(n),o.setAttribute("disabled","disabled"),T(s)})).catch((function(e){console.log("Ошибка: ".concat(e))})).finally((function(){g(N,!1)}))}));var O=u.querySelector(".popup__input"),j=u.querySelector(".popup__button-save");function J(e){var t,n;e.preventDefault(),g(j,!0),(t=m.value,n=f.value,fetch("".concat(w.baseUrl,"/users/me"),{method:"PATCH",headers:w.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return D(e)}))).then((function(e){p.textContent=e.name,_.textContent=e.about,T(u)})).catch((function(e){return console.log("Ошибка ".concat(e))})).finally((function(){g(j,!1)}))}i.addEventListener("click",(function(){A(u)})),a.addEventListener("click",(function(){T(u)}));var G=e.querySelector(".popup__button-save"),H=function(e){r.src=e};window.onload=function(){fetch("".concat(w.baseUrl,"/users/me"),{method:"GET",headers:w.headers}).then((function(e){return D(e)})).then((function(e){!function(e){H(e.avatar)}(e),function(e){p.textContent=e.name,_.textContent=e.about,O.addEventListener("submit",J)}(e),function(e){U=e,fetch("".concat(w.baseUrl,"/cards"),{method:"GET",headers:w.headers}).then((function(e){return D(e)})).then((function(t){t.reverse(),t.forEach((function(t){P(t,e,v)}))}))}(e)}))},l.addEventListener("click",(function(){A(s)})),d.addEventListener("click",(function(){T(s)})),S.addEventListener("click",(function(){T(h)})),t.addEventListener("click",(function(){A(e)})),c.addEventListener("submit",(function(t){var n;t.preventDefault(),n=o.value,g(G,!0),function(e){return fetch("".concat(w.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:w.headers,body:JSON.stringify({avatar:e})}).then((function(e){return D(e)}))}(n).then((function(t){H(t.avatar),c.reset(),T(e)})).catch((function(e){console.log(e)})).finally((function(){g(G,!1)}))})),n.addEventListener("click",(function(){T(e)})),function(e){document.querySelectorAll(e.formSelector).forEach((function(t){t.addEventListener("input",(function(t){return function(e,t){var n=e.target,o=e.currentTarget;(function(e,t){e.setCustomValidity("")})(n),function(e){document.querySelector("#error__".concat(e.id)).textContent=e.validationMessage}(n),function(e,t){var n=e.querySelector(t.submitButtonSelector);e.checkValidity()?(n.classList.remove(t.inActiveButtonClass),n.removeAttribute("disabled")):(n.classList.add(t.inActiveButtonClass),n.setAttribute("disabled","disabled"))}(o,t)}(t,e)}))}))}(B)})();